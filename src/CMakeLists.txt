PROJECT(ezlog VERSION 1.0.0 DESCRIPTION "ezlog static library")

IF(MSVC)
    SET(VERSIONINFO_RC ${PROJECT_BINARY_DIR}/VersionInfo.rc)
    CONFIGURE_FILE(${PROJECT_SOURCE_DIR}/VersionInfo.rc.in ${VERSIONINFO_RC})
ENDIF() # ENDIF MSVC

FILE(GLOB_RECURSE EXPORTS_FILES
    ${PROJECT_SOURCE_DIR}/*.def
)

FILE(GLOB_RECURSE PUBLIC_INCLUDE_FILES
    ${CMAKE_SOURCE_DIR}/include/*.h
)

FILE(GLOB_RECURSE INCLUDE_FILES
    ${PROJECT_SOURCE_DIR}/*.h
    ${PROJECT_SOURCE_DIR}/*.hpp
    ${PUBLIC_INCLUDE_FILES}
)

FILE(GLOB_RECURSE SOURCE_FILES
    ${PROJECT_SOURCE_DIR}/*.c
    ${PROJECT_SOURCE_DIR}/*.cpp
)

SOURCE_GROUP("Header Files" FILES "${INCLUDE_FILES}")
SOURCE_GROUP("Source Files" FILES "${SOURCE_FILES}")

ADD_LIBRARY(
    ${PROJECT_NAME}
    STATIC
    ${INCLUDE_FILES}
    ${SOURCE_FILES}
    ${EXPORTS_FILES}  # Add export file of C APIs.
    ${VERSIONINFO_RC} # Add version info.
)

IF(UNIX)
    SET(LINK_LIBS pthread)
ENDIF() # ENDIF UNIX

TARGET_LINK_LIBRARIES(
    ${PROJECT_NAME}
    ${LINK_LIBS}
)

INSTALL(
    TARGETS ${PROJECT_NAME}
    ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
)
INSTALL(
    FILES ${PUBLIC_INCLUDE_FILES}
    DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}
)

SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES VERSION ${PROJECT_VERSION} SOVERSION ${PROJECT_VERSION_MAJOR})